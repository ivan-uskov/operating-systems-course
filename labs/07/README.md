# Лабораторная работа №7

- [Лабораторная работа №7](#лабораторная-работа-7)
  - [Задания](#задания)
    - [Требования](#требования)
    - [Задание 1 — Визуализация дерева файлов — 50 баллов](#задание-1--визуализация-дерева-файлов--50-баллов)
    - [Задание 2 — Мониторинг изменений в файловой системе](#задание-2--мониторинг-изменений-в-файловой-системе)
      - [Вариант 1 — Мониторинг изменений в файловой системе Linux — 50 баллов](#вариант-1--мониторинг-изменений-в-файловой-системе-linux--50-баллов)
      - [Вариант 2 — Мониторинг изменений в файловой системе Windows — 50 баллов](#вариант-2--мониторинг-изменений-в-файловой-системе-windows--50-баллов)
    - [Задание 3 — Работа с функциями асинхронного ввода-вывода](#задание-3--работа-с-функциями-асинхронного-ввода-вывода)
      - [Асинхронный ввод-вывод файлов в Linux — 100 баллов](#асинхронный-ввод-вывод-файлов-в-linux--100-баллов)
      - [Асинхронный ввод-вывод файлов в Windows — 100 баллов](#асинхронный-ввод-вывод-файлов-в-windows--100-баллов)

## Задания

- Для получения оценки "удовлетворительно" нужно набрать не менее 80 баллов.
- Для получения оценки "хорошо" нужно набрать не менее 150 баллов.
- Для получения оценки "отлично" нужно набрать не менее 250 баллов.

### Требования

Обязательно проверяйте успешность всех вызовов функций операционной системы и не оставляйте ошибки незамеченными.

Ваш код должен иметь уровень безопасности исключений не ниже базового.
Для этого разработайте (или возьмите готовую) RAII-обёртку, автоматизирующую
управление ресурсами операционной системы.

### Задание 1 — Визуализация дерева файлов — 50 баллов

Ознакомьтесь с библиотекой [std::filesystem](https://en.cppreference.com/w/cpp/filesystem).

Напишите программу **filetree**, которая визуализирует дерево файлов и директорий.
Синтаксис командной строки:

```sh
filetree [DIR]
```

Параметр `DIR` задаёт путь к директории, начиная с которой надо построить дерево файлов.
Если он не указан, должна использоваться текущая директория.

Ожидаемый результат работы программы показан ниже:

```txt
mydir
|   [F] File.txt
|
+---[D] Directory 1
|       [F] File 1.txt
|       [F] File 2.txt
|
\---[D] Directory 2
    |   [F] input.txt
    |
    +---[D] Empty Dir 2
    \---[D] Non empty dir
        [F] File.txt
```

### Задание 2 — Мониторинг изменений в файловой системе

Выполните один или оба варианта задания.

#### Вариант 1 — Мониторинг изменений в файловой системе Linux — 50 баллов

Ознакомьтесь с [inotify API](https://man7.org/linux/man-pages/man7/inotify.7.html).
Напишите программу `fsmon` (File System MONitor) для ОС Linux,
которая отслеживает изменения в определённом каталоге:

- Добавление или удаление файла или каталога
- Изменение размера файла
- Изменение атрибутов файла

При каждом таком изменении программа должна вывести в консоль информацию о произошедшем событии:

- Имя файла
- Произошедшее с файлом событие

Синтаксис командной строки:

```bash
fsmon PATH
```

Параметр `PATH` задаёт путь к файлу.

#### Вариант 2 — Мониторинг изменений в файловой системе Windows — 50 баллов

Ознакомьтесь с [Directory Change Notification API](https://learn.microsoft.com/en-us/windows/win32/fileio/obtaining-directory-change-notifications).
Напишите программу `fsmonw` (File System MONitor for Windows) для ОС Windows,
которая отслеживает изменения в определённом каталоге:

- Добавление или удаление файла или каталога
- Изменение размера файла
- Изменение атрибутов файла

При каждом таком изменении программа должна вывести в консоль информацию о произошедшем событии:

- Имя файла
- Произошедшее с файлом событие

Синтаксис командной строки:

```bash
fsmonw PATH
```

Параметр `PATH` задаёт путь к файлу.

### Задание 3 — Работа с функциями асинхронного ввода-вывода

Выполните один или оба варианта заданий

#### Асинхронный ввод-вывод файлов в Linux — 100 баллов

Напишите программу acrypt (Async Crypt) для Linux, которая копирует входной файл в выходной,
шифруя данные. Шифрование выполняется путём инвертирования битов каждого байта исходного файла.
Размер файла такой, что не помещается целиком в оперативную память компьютера.
Ввод-вывод должен выполняться асинхронно, то есть не блокируя работу программы.
То есть, отправив операционной системе команду записывать зашифрованный блок данных из одного буфера,
программа может тут же инициировать асинхронную операцию чтения следующего блока данных в другой буфер.
Имея цепочку из нескольких буферов программа сможет быстрее выполнить работу, не прибегая к многопоточности.

Синтаксис командной строки:

```bash
acrypt INPUT_FILE_NAME OUTPUT_FILE_NAME
```

Сравните время работы асинхронной версии программы по сравнению с синхронной. Проанализируйте результаты и сделайте выводы.

Указание: изучите документацию [API для асинхронного ввода-вывода](https://man7.org/linux/man-pages/man7/aio.7.html).

#### Асинхронный ввод-вывод файлов в Windows — 100 баллов

Напишите программу acryptw (Async Crypt for Windows) для Windows, которая копирует входной файл в выходной,
шифруя данные. Функциональность программы аналогична программе из предыдущего варианта.

Сравните время работы асинхронной версии программы по сравнению с синхронной. Проанализируйте результаты и сделайте выводы.

Указание: изучите документацию
[API для асинхронного ввода-вывода в ОС Windows](https://learn.microsoft.com/en-us/windows/win32/fileio/synchronous-and-asynchronous-i-o).
